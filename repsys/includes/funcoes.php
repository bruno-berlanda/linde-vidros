<?php
/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
FUNÇÃO NOME E SOBRENOME
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function nome_sobrenome($nome) {
	
	$nome = strtr(strtoupper($nome),"àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ","ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß");
	
	$array = explode(" ",$nome);
	$n_palavras = count($array); // Conta a quantidade de palavras

		$ultimo = $n_palavras - 1;

	$nome_sobrenome = $array[0]." ".$array[$ultimo];
	
	return $nome_sobrenome;
		
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
PRIMEIRO NOME
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function primeiro_nome($nome) {
	
	$array = explode(" ",$nome);

	$primeiro_nome = $array[0];
	
	//$primeiro_nome = strtr(strtoupper($primeiro_nome),"àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ","ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß");
	
	return $primeiro_nome;
		
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
CONSULTA REPRESENTANTE
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function nome_representante($id, $conexao) {
	
	$consulta = mysqli_query ($conexao, "SELECT nome FROM representantes WHERE id='$id'") or die (mysqli_error());
		$dados = mysqli_fetch_array ($consulta);
			$nome = $dados['nome'];
	
	$nome = strtr(strtoupper($nome),"àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ","ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß");
	
	return $nome;
		
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
CONSULTA CLIENTE (COMPLETO)
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function cliente_completo($id, $conexao) {
	
	$consulta = mysqli_query ($conexao, "SELECT * FROM geral_clientes WHERE id='$id'") or die (mysqli_error());
		$dados = mysqli_fetch_array ($consulta);
			$cliente 	= $dados['cliente'];
			$rota 		= $dados['rota'];
			$cidade 	= $dados['cidade'];
			$uf 		= $dados['uf'];
	
	return $cliente." <small class=\"text-muted\">(".$rota.") - ".$cidade."/".$uf."</small>";
		
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
CONSULTA CLIENTE (NOVO)
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function cliente_novo($id, $conexao) {
	
	$consulta = mysqli_query ($conexao, "SELECT novo, fechou_venda FROM geral_clientes WHERE id='$id'") or die (mysqli_error());
		$dados = mysqli_fetch_array ($consulta);
			$novo 	= $dados['novo'];
			$venda 	= $dados['fechou_venda'];
	
	if ($novo == "S" && $venda == "S") {
		return "<span class=\"text-success\"><i class=\"fas fa-plus-square\" aria-hidden=\"true\"></i></span>";
	}
	elseif ($novo == "S" && $venda == "N") {
		return "<span class=\"text-warning\"><i class=\"fas fa-plus-square\" aria-hidden=\"true\"></i></span>";
	}
	elseif ($novo == "N") {
		return "<span class=\"text-super-muted\"><i class=\"far fa-square\" aria-hidden=\"true\"></i></span>";
	}
	
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
CÓDIGO EMBALAGEM
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function cod_embalagem($id, $conexao) {
	
	$consulta = mysqli_query ($conexao, "SELECT tipo FROM moveleiro_embalagens WHERE id='$id'") or die (mysqli_error());
		$dados = mysqli_fetch_array ($consulta);
			$tipo = $dados['tipo'];
	
	return $tipo;
		
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
UPLOAD DE FOTOS
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function upload($tmp, $name, $largura, $pasta, $nome_bd) {
		
	if (end(explode(".", $name)) == "jpg") {
		$img = imagecreatefromjpeg($tmp);
	}
	else if (end(explode(".", $name)) == "jpeg") {
		$img = imagecreatefromjpeg($tmp);
	}
	else if (end(explode(".", $name)) == "png") {
		$img = imagecreatefrompng($tmp);
	}
	else if (end(explode(".", $name)) == "gif") {
		$img = imagecreatefromgif($tmp);
	}

	$nome = $nome_bd;
	
	$x = imagesx($img);
	$y = imagesy($img);
	
	$largura = ($x > $largura) ? $largura : $x;
	$altura = ($largura * $y) / $x;
	
	$nova = imagecreatetruecolor($largura, $altura);
	imagecopyresampled($nova, $img, 0, 0, 0, 0, $largura, $altura, $x, $y);
	imagejpeg($nova, $pasta."/".$nome);
	imagedestroy($img);
	imagedestroy($nova);
	
	return $nome.".jpg";
	
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
ROTA: VENDEDOR
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function rota_vendedor($rota, $seg, $conexao) {
	
	if ($seg == "ENG" || $seg == "MOV") {
		$con_vend = mysqli_query ($conexao, "SELECT b.id FROM admin_rotas a, representantes b WHERE a.rota='$rota' AND a.produto='$seg' AND a.vendedor=b.id") or die (mysqli_error());
	}
	else {
		$con_vend = mysqli_query ($conexao, "SELECT b.id FROM representantes b WHERE b.segmento='$seg' AND b.ativo='S'") or die (mysqli_error());
	}
		$d_vend = mysqli_fetch_array ($con_vend);
			$vend_id = $d_vend['id'];
	
	return $vend_id;
		
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
ROTA: NOME
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function rota_nome($rota, $seg, $conexao) {
	
	if ($seg == "ENG" || $seg == "MOV") {
		$con_vend = mysqli_query ($conexao, "SELECT b.nome FROM admin_rotas a, representantes b WHERE a.rota='$rota' AND a.produto='$seg' AND a.vendedor=b.id") or die (mysqli_error());
	}
	else {
		$con_vend = mysqli_query ($conexao, "SELECT b.nome FROM representantes b WHERE b.segmento='$seg' AND b.ativo='S'") or die (mysqli_error());
	}
		
		$d_vend = mysqli_fetch_array ($con_vend);
			$vend_nome = $d_vend['nome'];
	
	return $vend_nome;
		
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
ROTA: E-MAIL
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
function rota_email($rota, $seg, $conexao) {
	
	if ($seg == "ENG" || $seg == "MOV") {
		$con_vend = mysqli_query ($conexao, "SELECT b.email FROM admin_rotas a, representantes b WHERE a.rota='$rota' AND a.produto='$seg' AND a.vendedor=b.id") or die (mysqli_error());
	}
	else {
		$con_vend = mysqli_query ($conexao, "SELECT b.email FROM representantes b WHERE b.segmento='$seg' AND b.ativo='S'") or die (mysqli_error());
	}
		
		$d_vend = mysqli_fetch_array ($con_vend);
			$vend_email = $d_vend['email'];
	
	return $vend_email;
		
}

/* ******************************************************************************************************************************************************************
*********************************************************************************************************************************************************************
DATAS
*********************************************************************************************************************************************************************
****************************************************************************************************************************************************************** */
$data_hoje = date ("Y-m-d");

$data_atual_bd = date("Y-m-d");
$hora_atual_bd = date("H:i:s");

$data_filtro_bd = date('Y-m-d', strtotime("-30 days"));

function mes_extenso($mes) {
	
	switch ($mes) {
		case "01":
			$mes_ext = "JANEIRO";
			break;
		case "02":
			$mes_ext = "FEVEREIRO";
			break;
		case "03":
			$mes_ext = "MARÇO";
			break;
		case "04":
			$mes_ext = "ABRIL";
			break;
		case "05":
			$mes_ext = "MAIO";
			break;
		case "06":
			$mes_ext = "JUNHO";
			break;
		case "07":
			$mes_ext = "JULHO";
			break;
		case "08":
			$mes_ext = "AGOSTO";
			break;
		case "09":
			$mes_ext = "SETEMBRO";
			break;
		case "10":
			$mes_ext = "OUTUBRO";
			break;
		case "11":
			$mes_ext = "NOVEMBRO";
			break;
		case "12":
			$mes_ext = "DEZEMBRO";
	}
	
	return $mes_ext;
		
}